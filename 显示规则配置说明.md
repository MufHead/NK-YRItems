# 显示规则配置说明

## 概述

YRItems 现在完全由 **YAML配置文件** 控制动态Lore显示，不再有任何硬编码的属性计算逻辑。

## 配置文件位置

```
YRItems/
  └── configs/
      ├── display_rules.yml   # 显示规则配置
      └── 你的自定义.yml        # 可以创建多个配置文件
```

## 基本概念

### 显示规则结构

每个规则定义如何显示一个NBT属性：

```yaml
规则名称:
  nbt_key: "NBT键名"           # 要读取的NBT键
  display_format: "显示格式"   # 如何显示（可选）
  value_mappings: {}          # 值映射（可选）
  value_ranges: []            # 范围映射（可选）
```

## 示例1：强化等级（值映射）

### 需求
- NBT键：`level`，类型：int，值：0/1/2
- 显示：
  - level=0 → "强化等级 1" + "初级强化"
  - level=1 → "强化等级 2" + "中级强化"
  - level=2 → "强化等级 3" + "高级强化"

### 配置

```yaml
enhance_level:
  nbt_key: "level"

  value_mappings:
    0:
      level_text: "§f强化等级 §71§f"
      description: "§7初级强化"
    1:
      level_text: "§f强化等级 §e2§f"
      description: "§e中级强化"
    2:
      level_text: "§f强化等级 §63§f"
      description: "§6高级强化"
```

### 物品NBT

```yaml
example_sword:
  identifier: "minecraft:diamond_sword"
  name: "§6强化之剑"
  lore: []  # 留空，动态生成
  nbt:
    YRAttributes:
      level: 1  # 强化等级
```

### 显示效果

```
§8§m--------------------
§f强化等级 §e2§f
§e中级强化
§8§m--------------------
```

## 示例2：耐久度（范围映射）

### 需求
- NBT键：`Durability`
- 根据数值显示不同颜色：
  - 0-30：红色
  - 31-70：黄色
  - 71+：绿色

### 配置

```yaml
durability:
  nbt_key: "Durability"
  display_format: "耐久度: {value}"

  value_ranges:
    - min: 0
      max: 30
      color: "§c"  # 红色
    - min: 31
      max: 70
      color: "§e"  # 黄色
    - min: 71
      max: 999999
      color: "§a"  # 绿色
```

### 显示效果

```
Durability = 20  → §c耐久度: 20
Durability = 50  → §e耐久度: 50
Durability = 100 → §a耐久度: 100
```

## 示例3：简单属性（格式化字符串）

### 配置

```yaml
damage:
  nbt_key: "Damage"
  display_format: "§c攻击力: §f{value}"

defense:
  nbt_key: "Defense"
  display_format: "§9防御力: §f{value}"

crit_rate:
  nbt_key: "CritRate"
  display_format: "§e暴击率: §f{value}%"
```

### 物品NBT

```yaml
YRAttributes:
  Damage: 100
  Defense: 50
  CritRate: 25
```

### 显示效果

```
§c攻击力: §f100
§9防御力: §f50
§e暴击率: §f25%
```

## 示例4：特殊效果（复杂映射）

### 配置

```yaml
special_effects:
  nbt_key: "SpecialEffect"

  value_mappings:
    "fire":
      display: "§c§l特殊效果"
      description: "§c火焰附加: 攻击时有30%几率点燃敌人"
    "freeze":
      display: "§b§l特殊效果"
      description: "§b冰冻: 攻击时有20%几率冻结敌人2秒"
    "poison":
      display: "§2§l特殊效果"
      description: "§2剧毒: 攻击时有25%几率造成持续毒伤害"
```

### 物品NBT

```yaml
YRAttributes:
  SpecialEffect: "fire"
```

### 显示效果

```
§c§l特殊效果
§c火焰附加: 攻击时有30%几率点燃敌人
```

## 占位符

在 `display_format` 中可以使用以下占位符：

| 占位符 | 说明 | 示例 |
|--------|------|------|
| `{value}` | NBT原始值 | level=2 → "2" |
| `{value_plus_1}` | NBT值+1 | level=2 → "3" |

## 配置优先级

脚本按以下顺序处理规则：

1. **值映射** (`value_mappings`) - 精确匹配
2. **范围映射** (`value_ranges`) - 范围匹配
3. **格式化字符串** (`display_format`) - 默认显示

## 多个配置文件

你可以创建多个配置文件来组织规则：

```
configs/
  ├── display_rules.yml      # 通用显示规则
  ├── weapon_rules.yml       # 武器专用规则
  ├── armor_rules.yml        # 防具专用规则
  └── special_effects.yml    # 特殊效果规则
```

所有配置文件会在启动时自动加载。

## 重载配置

修改配置文件后，使用以下命令重载：

```
/yritems reload
```

这会：
- ✓ 重载所有YAML配置
- ✓ 重载所有JavaScript脚本
- ✓ 清除缓存并重新注册事件监听器

**无需重启服务器！**

## 完整示例：RPG武器

### 配置文件

```yaml
# configs/rpg_weapon.yml

weapon_level:
  nbt_key: "level"
  value_mappings:
    0:
      level_text: "§f[Lv.1]"
      description: "§7新手武器"
    1:
      level_text: "§e[Lv.2]"
      description: "§e进阶武器"
    2:
      level_text: "§6[Lv.3]"
      description: "§6精良武器"

base_damage:
  nbt_key: "Damage"
  display_format: "§c⚔ 基础攻击: §f{value}"

critical_chance:
  nbt_key: "CritRate"
  display_format: "§e☆ 暴击率: §f{value}%"

durability:
  nbt_key: "Durability"
  display_format: "耐久: {value}/1000"
  value_ranges:
    - min: 0
      max: 300
      color: "§c"
    - min: 301
      max: 700
      color: "§e"
    - min: 701
      max: 1000
      color: "§a"
```

### 物品NBT

```yaml
legendary_sword:
  identifier: "minecraft:diamond_sword"
  name: "§6传说之刃"
  lore: []
  nbt:
    YRAttributes:
      level: 2
      Damage: 150
      CritRate: 35
      Durability: 850
```

### 显示效果

```
§8§m--------------------
§6[Lv.3]
§6精良武器
§c⚔ 基础攻击: §f150
§e☆ 暴击率: §f35%
§a耐久: 850/1000
§8§m--------------------
```

## 注意事项

1. **NBT键名区分大小写**
   - `Damage` ≠ `damage`

2. **颜色代码**
   - 使用 § 符号（§0-§f, §k-§r）
   - 示例：§c (红色), §a (绿色), §6 (金色)

3. **规则顺序**
   - 配置文件中的规则按声明顺序显示
   - 建议按重要性排序

4. **性能**
   - 配置在启动时加载并缓存
   - 修改后需要 `/yritems reload`

## 总结

- ✅ **完全配置驱动** - 无需修改代码
- ✅ **灵活的显示规则** - 值映射、范围映射、格式化
- ✅ **热重载** - 修改立即生效
- ✅ **多文件支持** - 分类组织规则
- ✅ **无限扩展** - 添加任意自定义规则
